#!/bin/bash

# Git Workflow Guardrail: Prevent direct push to main/master
# See docs/solutions/process-violations/direct-push-to-main.md

branch=$(git rev-parse --abbrev-ref HEAD)

if [ "$branch" = "main" ] || [ "$branch" = "master" ]; then
  echo ""
  echo "============================================"
  echo "ERROR: Direct push to '$branch' is BLOCKED"
  echo "============================================"
  echo ""
  echo "This repository follows Shape Up methodology."
  echo "All changes must go through feature branches and PRs."
  echo ""
  echo "Required workflow:"
  echo "  1. git checkout -b feat/your-feature"
  echo "  2. git push -u origin feat/your-feature"
  echo "  3. gh pr create"
  echo ""
  echo "Current branch: $branch"
  echo ""
  echo "To bypass (NOT RECOMMENDED):"
  echo "  git push --no-verify origin $branch"
  echo ""
  exit 1
fi

echo "Pre-push check passed: branch '$branch' is allowed"
